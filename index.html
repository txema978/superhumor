<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Colecci√≥n Superhumor ‚Äî PWA + Supabase (v3.9)</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="apple-touch-icon" href="icon-192.png">
  <meta name="theme-color" content="#2563eb">
  <style>
    :root { --bg:#f6f7fb; --card:#fff; --text:#1f2937; --muted:#6b7280; --brand:#2563eb; --green:#16a34a; --red:#dc2626; --border:#e5e7eb; }
    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:var(--text);background:var(--bg)}
    .wrap{max-width:1100px;margin:24px auto;padding:0 16px}
    .header{background:linear-gradient(90deg,#2563eb,#1e40af);color:#fff;border-radius:14px;padding:16px;display:flex;align-items:center;gap:12px}
    .title{font-size:clamp(20px,3vw,26px);font-weight:800;letter-spacing:-.02em;margin:0}
    .sub{margin:2px 0 0;color:#e5e7eb}
    .grid3{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px;margin-top:12px}
    .stat{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px}
    .stat b{font-size:22px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:14px}
    .row{display:flex;gap:12px;align-items:center}
    .seg{display:flex;gap:8px;flex-wrap:wrap;margin:12px 0}
    .btn{border:1px solid var(--border);background:#fff;padding:8px 12px;border-radius:10px;cursor:pointer}
    .btn:hover{border-color:#cbd5e1}
    .btn.brand{background:var(--brand);color:#fff;border-color:transparent}
    .btn.green{background:var(--green);color:#fff;border-color:transparent}
    .btn.red{background:var(--red);color:#fff;border-color:transparent}
    .seg .btn{padding:6px 10px;font-size:14px}
    .seg .btn.active{background:var(--brand);color:#fff;border-color:transparent}
    .small{font-size:12px;color:var(--muted)}
    input[type="text"]{width:100%;padding:10px 12px;border-radius:10px;border:1px solid var(--border);outline:0}
    input[type="text"]:focus{border-color:#cbd5e1}
    .results{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:12px;margin:12px 0}
    .badge{display:inline-block;font-size:12px;padding:2px 8px;border-radius:999px;border:1px solid var(--border);background:#fff;color:#6b7280}
    .badge.ok{border-color:#86efac;color:#166534;background:#f0fdf4}
    .badge.no{border-color:#fecaca;color:#7f1d1d;background:#fef2f2}
    .cards{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px}
    @media(max-width:960px){.cards{grid-template-columns:repeat(2,minmax(0,1fr))}}
    @media(max-width:640px){.cards{grid-template-columns:1fr}}
    .progress{background:#e5e7eb;border-radius:999px;height:10px;overflow:hidden}
    .progress>div{height:100%;background:linear-gradient(90deg,#22c55e,#16a34a);width:0%;transition:width .3s ease}
    .center{text-align:center}
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.75);display:flex;align-items:center;justify-content:center;padding:20px}
    .modal>div{position:relative;max-width:90vw;max-height:90vh}
    .modal img{max-width:90vw;max-height:90vh;border-radius:12px;display:block}
    .close{position:absolute;right:8px;top:8px}
    .img-frame{position:relative;width:100%;background:#f9fafb;border:1px dashed #d1d5db;border-radius:10px;overflow:hidden;display:flex;align-items:center;justify-content:center}
    .img-frame img{max-width:100%;max-height:100%;object-fit:contain;display:block}
    .cover-spine{display:flex;gap:6px;align-items:stretch}
    .cover-col{flex:1 1 220px;min-width:180px;display:flex;flex-direction:column}
    .spine-col{flex:0 0 50px;width:50px;display:flex;flex-direction:column}
    .cover-col .img-frame{aspect-ratio:3/4;width:100%}
    .spine-col .img-frame{height:100%;width:100%}
    .thumb-tools{position:absolute;right:6px;top:6px;display:flex;gap:6px}
    .right{margin-left:auto}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div style="font-size:26px">üìö</div>
      <div>
        <h1 class="title">Colecci√≥n Superhumor</h1>
        <div class="sub">Gestiona tu colecci√≥n completa de 67 tomos ‚Äî v3.9</div>
      </div>
      <div class="right">
        <button class="btn" id="btn-login">Iniciar sesi√≥n</button>
        <button class="btn" id="btn-logout" style="display:none">Cerrar sesi√≥n</button>
      </div>
    </div>

    <div class="grid3">
      <div class="stat"><div class="small">Tomos que tienes</div><b id="st-tengo">0</b></div>
      <div class="stat"><div class="small">Tomos que faltan</div><b id="st-faltan">67</b></div>
      <div class="stat"><div class="small">Completado</div><b id="st-pct">0%</b></div>
    </div>

    <div class="card" style="margin-top:12px">
      <div class="row">
        <input id="in-busqueda" type="text" placeholder="Escribe n√∫meros (ej: 5, 12, 23-25, 30)"/>
        <button class="btn brand" id="btn-buscar">Buscar</button>
      </div>
      <div class="small">Puedes buscar uno o varios n√∫meros separados por comas, espacios o guiones.</div>
    </div>

    <div id="box-resultados" class="results" style="display:none">
      <div class="row" style="justify-content:space-between">
        <h4 style="margin:0" id="res-title">Resultados de b√∫squeda</h4>
        <button class="btn" id="btn-cerrar-res">‚úñ Cerrar</button>
      </div>
      <div id="res-cards" class="cards" style="margin-top:10px"></div>
    </div>

    <div class="seg">
      <button class="btn active" data-filtro="todos">Todos (67)</button>
      <button class="btn" data-filtro="tengo">Que tengo (0)</button>
      <button class="btn" data-filtro="faltan">Que me faltan (67)</button>
    </div>

    <div id="cards" class="cards"></div>

    <div class="card" style="margin-top:12px">
      <div class="row" style="justify-content:space-between">
        <span class="small">Progreso de la colecci√≥n</span>
        <span class="small" id="st-cont">0 de 67 tomos</span>
      </div>
      <div class="progress"><div id="bar" style="width:0%"></div></div>
    </div>
  </div>

  <!-- Supabase client -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.js"></script>

  <script>
    // ===== PWA SW =====
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function(){
        navigator.serviceWorker.register('./service-worker-v35.js').catch(function(){});
      });
    }

    function $(sel, el){ return (el||document).querySelector(sel); }

    // ====== Supabase config ======
    const SUPABASE_URL = 'https://qjmugmnrgxccliyrlwfz.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFqbXVnbW5yZ3hjY2xpeXJsd2Z6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU3ODQzOTIsImV4cCI6MjA3MTM2MDM5Mn0.ZMM9eNBj4HQxJqZ-RKDS8YLCL20xf3geyHnLm1kGUPo';
    const BUCKET = 'imagenes';
    const sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    function updateAuthButtons(){
      sb.auth.getSession().then(({ data }) => {
        const has = !!(data && data.session);
        $('#btn-login').style.display = has ? 'none':'inline-block';
        $('#btn-logout').style.display = has ? 'inline-block':'none';
      });
    }
    updateAuthButtons();
    $('#btn-login').addEventListener('click', async () => {
      const email = prompt('Email de Supabase');
      const pass = prompt('Contrase√±a (no se guarda)');
      if (!email || !pass) return;
      const { error } = await sb.auth.signInWithPassword({ email, password: pass });
      if (error) alert('Inicio de sesi√≥n fall√≥: ' + error.message);
      updateAuthButtons();
    });
    $('#btn-logout').addEventListener('click', async () => {
      await sb.auth.signOut(); updateAuthButtons();
    });
    async function ensureAuth(){
      const { data } = await sb.auth.getSession();
      if (data && data.session) return true;
      throw new Error('NEEDS_LOGIN');
    }

    // ===== Cache API helpers =====
    var IMG_CACHE = 'sh-images-v1';
    function imgKey(kind, num){ return 'https://superhumor.local/'+kind+'/'+num; } // kind = 'portadas' | 'lomos'

    function ensureCachesAvailable(){
      if (!('caches' in window)) throw new Error('CACHE_API_UNAVAILABLE');
    }
    function cachePutBlob(key, blob){
      ensureCachesAvailable();
      return caches.open(IMG_CACHE).then(function(cache){
        var req = new Request(key);
        var res = new Response(blob, { headers: { 'Content-Type': blob.type || 'image/jpeg' } });
        return cache.put(req, res);
      });
    }
    function cacheGetBlob(key){
      ensureCachesAvailable();
      return caches.open(IMG_CACHE).then(function(cache){
        return cache.match(new Request(key));
      }).then(function(res){
        if (!res) return null;
        return res.blob();
      });
    }
    function cacheDelete(key){
      ensureCachesAvailable();
      return caches.open(IMG_CACHE).then(function(cache){
        return cache.delete(new Request(key));
      });
    }

    // ===== Resize before save/upload =====
    function resizeImage(file, maxW, maxH, quality){
      return new Promise(function(resolve, reject){
        var img = new Image();
        var reader = new FileReader();
        reader.onload = function(e){
          img.onload = function(){
            try{
              var w = img.naturalWidth || img.width;
              var h = img.naturalHeight || img.height;
              var ratio = Math.min(maxW/w, maxH/h, 1);
              var W = Math.round(w * ratio);
              var H = Math.round(h * ratio);
              var c = document.createElement('canvas');
              c.width = W; c.height = H;
              var ctx = c.getContext('2d');
              ctx.drawImage(img, 0, 0, W, H);
              if (c.toBlob) {
                c.toBlob(function(blob){ if(!blob) return reject(new Error('No blob')); resolve(blob); }, 'image/jpeg', quality);
              } else {
                try {
                  var dataUrl = c.toDataURL('image/jpeg', quality);
                  fetch(dataUrl).then(r=>r.blob()).then(resolve, reject);
                } catch(err){ reject(err); }
              }
            }catch(err){ reject(err); }
          };
          img.onerror = reject;
          img.src = e.target.result;
        };
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    var STORAGE_KEY = 'superhumor_v3_imgsInCache';
    var state = { tomos:[], filtro:'todos', busqueda:'', resultados:[] };

    function emptyTomo(){ return { tengo:false, comentario:'', portadaKey:null, lomoKey:null, portadaPath:null, lomoPath:null }; }

    function ensure67(arr){
      if (!arr || !arr.length){ arr = new Array(68); }
      for (var i=1;i<=67;i++){ if (!arr[i]) arr[i] = emptyTomo(); }
      return arr;
    }

    function load(){
      try{
        var raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return null;
        var parsed = JSON.parse(raw);
        return parsed && parsed.tomos ? parsed.tomos : null;
      }catch(e){ return null; }
    }

    function save(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify({ tomos: state.tomos }));
    }

    function init(){
      state.tomos = ensure67(load());
      save();
      render();
      window.addEventListener('resize', function(){ setTimeout(syncSpineHeights, 0); });
    }

    function stats(){
      var tengo=0;
      for (var i=1;i<=67;i++){ if (state.tomos[i] && state.tomos[i].tengo) tengo++; }
      return { tengo:tengo, faltan:67-tengo, pct: Math.round((tengo/67)*100) };
    }

    function renderStats(){
      var s = stats();
      $('#st-tengo').textContent = s.tengo;
      $('#st-faltan').textContent = s.faltan;
      $('#st-pct').textContent = s.pct + '%';
      $('#st-cont').textContent = s.tengo + ' de 67 tomos';
      var seg = document.querySelectorAll('.seg .btn');
      for (var i=0;i<seg.length;i++){
        var f = seg[i].getAttribute('data-filtro');
        seg[i].classList.toggle('active', f === state.filtro);
        if (f==='tengo') seg[i].textContent = 'Que tengo ('+s.tengo+')';
        if (f==='faltan') seg[i].textContent = 'Que me faltan ('+s.faltan+')';
      }
      $('#bar').style.width = (s.tengo/67*100).toFixed(2)+'%';
    }

    function cardHTML(num, tomo){
      var html = '';
      html += '<div class="card" data-num="'+num+'">';
      html += '<h3 style="margin-top:0">Tomo '+num+'</h3>';
      html += '<div class="row" style="gap:8px">';
      html += '<button class="btn '+(tomo.tengo?'green':'')+'" data-action="toggle">'+(tomo.tengo?'‚úì Lo tengo':'Marcar como tengo')+'</button>';
      html += '<span class="badge '+(tomo.tengo?'ok':'no')+'">'+(tomo.tengo?'‚úì LO TIENES':'‚úó TE FALTA')+'</span>';
      html += '</div>';

      if (tomo.tengo){
        html += '<div class="cover-spine" style="margin-top:8px">';
        html += '<div class="cover-col"><div class="small" style="margin:6px 0">Portada (completa)</div>';
        html += '<div class="img-frame js-cover-frame" data-kind="portadas">';
        html += '<div class="thumb-tools">';
        html += '<button class="btn" data-action="ver-portada">üëÅÔ∏è</button>';
        html += '<button class="btn red" data-action="eliminar-portada">üóëÔ∏è</button>';
        html += '</div>';
        if (tomo.portadaKey){ html += '<img class="js-cover-img" alt="Portada tomo '+num+'"/>'; }
        else { html += '<label style="cursor:pointer"><input type="file" accept="image/*" style="display:none" data-action="subir-portada"/><div class="center" style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center;gap:8px;color:#6b7280;"><span>üì∑</span><span>Subir portada</span></div></label>'; }
        html += '</div></div>';

        html += '<div class="spine-col"><div class="small" style="margin:6px 0">Lomo</div>';
        html += '<div class="img-frame js-spine-frame" data-kind="lomos">';
        html += '<div class="thumb-tools">';
        html += '<button class="btn" data-action="ver-lomo">üëÅÔ∏è</button>';
        html += '<button class="btn red" data-action="eliminar-lomo">üóëÔ∏è</button>';
        html += '</div>';
        if (tomo.lomoKey){ html += '<img class="js-spine-img" alt="Lomo tomo '+num+'"/>'; }
        else { html += '<label style="cursor:pointer"><input type="file" accept="image/*" style="display:none" data-action="subir-lomo"/><div class="center" style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center;gap:8px;color:#6b7280;"><span>üì∑</span><span>Subir lomo</span></div></label>'; }
        html += '</div></div>';

        html += '</div>';
      }

      html += '<div style="margin-top:10px"><div class="small" style="margin-bottom:6px">Comentario</div><div data-editable="wrap">';
      if (tomo._editando){
        var safe = (tomo.comentario||'').replace(/[&<>]/g,'');
        html += '<textarea data-editable="textarea">'+safe+'</textarea><div class="row" style="gap:8px;margin-top:6px"><button class="btn brand" data-action="guardar-comentario">üíæ Guardar</button><button class="btn" data-action="cancelar-comentario">Cancelar</button></div>';
      } else {
        var safe2 = tomo.comentario ? tomo.comentario.replace(/[&<>]/g,'') : '';
        html += '<div class="small" data-action="editar-comentario" style="cursor:pointer;'+(tomo.comentario?'white-space:pre-wrap':'')+'">'+(safe2 || '<span style="font-style:italic;color:#9ca3af">Haz clic para a√±adir comentario‚Ä¶</span>')+'</div>';
      }
      html += '</div></div></div>';
      return html;
    }

    function render(){
      renderStats();
      var html = '';
      for (var i=1;i<=67;i++){
        var t = state.tomos[i];
        if (!t) continue;
        if (state.filtro==='tengo' && !t.tengo) continue;
        if (state.filtro==='faltan' && t.tengo) continue;
        html += cardHTML(i, t);
      }
      $('#cards').innerHTML = html;
      setTimeout(loadAllVisibleImages, 0);
      setTimeout(syncSpineHeights, 0);
    }

    function loadAllVisibleImages(){
      var cards = document.querySelectorAll('.card[data-num]');
      cards.forEach(function(card){
        var num = parseInt(card.getAttribute('data-num'),10);
        var t = state.tomos[num];
        if (!t) return;
        if (t.portadaKey){
          cacheGetBlob(t.portadaKey).then(function(blob){
            if (!blob) return;
            var img = card.querySelector('.js-cover-img');
            if (img){ img.src = URL.createObjectURL(blob); }
          });
        }
        if (t.lomoKey){
          cacheGetBlob(t.lomoKey).then(function(blob){
            if (!blob) return;
            var img2 = card.querySelector('.js-spine-img');
            if (img2){ img2.src = URL.createObjectURL(blob); }
          });
        }
      });
    }

    function buscar(){
      var nums = parseBusqueda(state.busqueda);
      var box = $('#box-resultados');
      if (!nums.length){ state.resultados=[]; box.style.display='none'; return; }
      var html='';
      for (var i=0;i<nums.length;i++){
        var n = nums[i]; var t = state.tomos[n] || emptyTomo();
        html += cardHTML(n, t);
      }
      $('#res-title').textContent = 'Resultados de b√∫squeda ('+nums.length+' tomos)';
      $('#res-cards').innerHTML = html;
      box.style.display='block';
      setTimeout(loadAllVisibleImages, 0);
      setTimeout(syncSpineHeights, 0);
    }

    function parseBusqueda(text){
      var parts = text.split(/[,\s]+/);
      var out = []; var used = {};
      for (var i=0;i<parts.length;i++){
        var p = parts[i].trim(); if (!p) continue;
        if (/^\d+-\d+$/.test(p)){
          var ab = p.split('-'); var a = parseInt(ab[0],10), b = parseInt(ab[1],10);
          if (!isNaN(a)&&!isNaN(b)&&a<=b){ for (var n=a;n<=b;n++){ if (n>=1&&n<=67 && !used[n]){ out.push(n); used[n]=1; } } }
        } else if (/^\d+$/.test(p)){
          var n = parseInt(p,10); if (n>=1&&n<=67 && !used[n]){ out.push(n); used[n]=1; }
        }
      }
      out.sort(function(a,b){return a-b;});
      return out;
    }

    function syncSpineHeights(){
      var pairs = document.querySelectorAll('.cover-spine');
      for (var i=0;i<pairs.length;i++){
        var pair=pairs[i];
        var cover = pair.querySelector('.cover-col .js-cover-frame');
        var spine = pair.querySelector('.spine-col .js-spine-frame');
        if (!cover || !spine) continue;
        spine.style.height='auto';
        var h = cover.getBoundingClientRect().height;
        if (h>0) spine.style.height = h+'px';
      }
    }

    document.addEventListener('click', function(e){
      var actionEl = e.target.closest('[data-action]');
      var card = e.target.closest('.card[data-num]');
      var num = card ? parseInt(card.getAttribute('data-num'),10) : null;
      if (actionEl){
        var action = actionEl.getAttribute('data-action');
        if (action==='toggle' && num){ state.tomos[num].tengo = !state.tomos[num].tengo; save(); render(); return; }
        if (action==='ver-portada' && num){ var t=state.tomos[num]; if (t.portadaKey){ cacheGetBlob(t.portadaKey).then(function(b){ if(!b) return; showModal(URL.createObjectURL(b)); }); } return; }
        if (action==='eliminar-portada' && num){ var t=state.tomos[num]; if (t.portadaKey){ cacheDelete(t.portadaKey).then(function(){ t.portadaKey=null; save(); render(); }); } return; }
        if (action==='ver-lomo' && num){ var t2=state.tomos[num]; if (t2.lomoKey){ cacheGetBlob(t2.lomoKey).then(function(b){ if(!b) return; showModal(URL.createObjectURL(b)); }); } return; }
        if (action==='eliminar-lomo' && num){ var t3=state.tomos[num]; if (t3.lomoKey){ cacheDelete(t3.lomoKey).then(function(){ t3.lomoKey=null; save(); render(); }); } return; }
        if (action==='editar-comentario' && num){ state.tomos[num]._editando=true; render(); return; }
        if (action==='guardar-comentario' && num){ var ta=card.querySelector('[data-editable="textarea"]'); state.tomos[num].comentario=ta.value; state.tomos[num]._editando=false; save(); render(); return; }
        if (action==='cancelar-comentario' && num){ state.tomos[num]._editando=false; render(); return; }
      }
      var filtroBtn = e.target.closest('[data-filtro]');
      if (filtroBtn){ state.filtro = filtroBtn.getAttribute('data-filtro'); var bs=document.querySelectorAll('.seg .btn'); for (var j=0;j<bs.length;j++) bs[j].classList.remove('active'); filtroBtn.classList.add('active'); render(); }
      if (e.target.closest('#btn-cerrar-res')){ $('#box-resultados').style.display='none'; state.resultados=[]; state.busqueda=''; $('#in-busqueda').value=''; }
      if (e.target.closest('#btn-buscar')){ buscar(); }
    });

    document.addEventListener('change', function(e){
      var input = e.target.closest('input[type="file"][data-action]');
      if (!input) return;
      var card = e.target.closest('.card[data-num]'); var num = card?parseInt(card.getAttribute('data-num'),10):null;
      var act = input.getAttribute('data-action');
      var file = input.files && input.files[0];
      if (!(num && file && file.type && file.type.indexOf('image/')===0)) return;

      var isPortada = (act === 'subir-portada');
      var maxW = isPortada ? 1200 : 300; // Portada grande, lomo estrecho
      var maxH = 1600;

      resizeImage(file, maxW, maxH, 0.8)
        .then(function(blob){
          // 1) Guardar local (Cache Storage) para que funcione offline
          var kind = isPortada ? 'portadas' : 'lomos';
          var key = imgKey(kind, num);
          return cachePutBlob(key, blob).then(function(){
            if (isPortada) state.tomos[num].portadaKey = key;
            else state.tomos[num].lomoKey = key;
            save(); render();
            return { blob: blob, kind: kind };
          });
        })
        .then(async function(info){
          // 2) Subir a Supabase (si has iniciado sesi√≥n)
          try{
            await ensureAuth();
          }catch(err){
            if (String(err.message) === 'NEEDS_LOGIN'){
              alert('Para subir a la nube debes iniciar sesi√≥n (bot√≥n arriba a la derecha). La imagen ya se guard√≥ localmente.');
              return;
            }
            throw err;
          }
          var path = 'uploads/'+Date.now()+'_'+info.kind+'_'+num+'.jpg';
          const { error, data } = await sb.storage.from(BUCKET).upload(path, info.blob, {
            contentType: info.blob.type || 'image/jpeg',
            upsert: false
          });
          if (error) {
            console.warn('Fallo al subir a Supabase:', error);
            alert('No se pudo subir a la nube: '+error.message);
          } else {
            const pub = sb.storage.from(BUCKET).getPublicUrl(data.path).data.publicUrl;
            if (info.kind === 'portadas') state.tomos[num].portadaPath = data.path;
            else state.tomos[num].lomoPath = data.path;
            save();
            console.log('Subida OK:', pub);
          }
        })
        .catch(function(err){
          let msg = 'No se pudo procesar/guardar la imagen.';
          if (String(err&&err.message).includes('CACHE_API_UNAVAILABLE')) {
            msg = 'Tu iPhone no soporta Cache Storage en esta versi√≥n. Actualiza iOS o usa Safari normal.';
          }
          alert(msg);
        });
    });

    $('#in-busqueda').addEventListener('input', function(e){ state.busqueda = e.target.value; });
    $('#in-busqueda').addEventListener('keydown', function(e){ if (e.key==='Enter') buscar(); });

    function showModal(src){
      var m=document.createElement('div'); m.className='modal'; m.innerHTML='<div><button class="btn close">‚úñ</button><img src="'+src+'" alt="Imagen"/></div>';
      m.addEventListener('click', function(){ m.remove(); });
      document.body.appendChild(m);
    }

    init();
  </script>
  <!-- trigger rebuild -->
</body>
</html>
